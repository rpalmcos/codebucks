{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = SideEffect;\nvar _interop_require_wildcard = require(\"@swc/helpers/lib/_interop_require_wildcard.js\").default;\nvar _react = _interop_require_wildcard(require(\"react\"));\nfunction SideEffect(props) {\n  const {\n    headManager,\n    reduceComponentsToState\n  } = props;\n  function emitChange() {\n    if (headManager && headManager.mountedInstances) {\n      const headElements = _react.Children.toArray(Array.from(headManager.mountedInstances).filter(Boolean));\n      headManager.updateHead(reduceComponentsToState(headElements, props));\n    }\n  }\n  if (isServer) {\n    var ref;\n    headManager == null ? void 0 : (ref = headManager.mountedInstances) == null ? void 0 : ref.add(props.children);\n    emitChange();\n  }\n  useClientOnlyLayoutEffect(() => {\n    var ref1;\n    headManager == null ? void 0 : (ref1 = headManager.mountedInstances) == null ? void 0 : ref1.add(props.children);\n    return () => {\n      var ref;\n      headManager == null ? void 0 : (ref = headManager.mountedInstances) == null ? void 0 : ref.delete(props.children);\n    };\n  });\n  // We need to call `updateHead` method whenever the `SideEffect` is trigger in all\n  // life-cycles: mount, update, unmount. However, if there are multiple `SideEffect`s\n  // being rendered, we only trigger the method from the last one.\n  // This is ensured by keeping the last unflushed `updateHead` in the `_pendingUpdate`\n  // singleton in the layout effect pass, and actually trigger it in the effect pass.\n  useClientOnlyLayoutEffect(() => {\n    if (headManager) {\n      headManager._pendingUpdate = emitChange;\n    }\n    return () => {\n      if (headManager) {\n        headManager._pendingUpdate = emitChange;\n      }\n    };\n  });\n  useClientOnlyEffect(() => {\n    if (headManager && headManager._pendingUpdate) {\n      headManager._pendingUpdate();\n      headManager._pendingUpdate = null;\n    }\n    return () => {\n      if (headManager && headManager._pendingUpdate) {\n        headManager._pendingUpdate();\n        headManager._pendingUpdate = null;\n      }\n    };\n  });\n  return null;\n}\nconst isServer = typeof window === 'undefined';\nconst useClientOnlyLayoutEffect = isServer ? () => {} : _react.useLayoutEffect;\nconst useClientOnlyEffect = isServer ? () => {} : _react.useEffect;","map":{"version":3,"names":["SideEffect","_react","_interop_require_wildcard","require","props","headManager","reduceComponentsToState","emitChange","mountedInstances","headElements","Children","toArray","Array","from","filter","Boolean","updateHead","isServer","ref","add","children","useClientOnlyLayoutEffect","ref1","delete","_pendingUpdate","useClientOnlyEffect","window","useLayoutEffect","useEffect"],"sources":["../../../src/shared/lib/side-effect.tsx"],"sourcesContent":[null],"mappings":"AAAA;;;;;kBAmBwBA,UAAU;;AAnB0B,IAAAC,MAAO,GAAAC,yBAAA,CAAAC,OAAA,CAAP,OAAO;AAmBpD,SAASH,UAAUA,CAACI,KAAsB,EAAE;EACzD,MAAM;IAAEC,WAAW;IAAEC;EAAuB,CAAE,GAAGF,KAAK;EAEtD,SAASG,UAAUA,CAAA,EAAG;IACpB,IAAIF,WAAW,IAAIA,WAAW,CAACG,gBAAgB,EAAE;MAC/C,MAAMC,YAAY,GAAGR,MAAQ,CAAAS,QAAA,CAACC,OAAO,CACnCC,KAAK,CAACC,IAAI,CAACR,WAAW,CAACG,gBAAgB,CAAiB,CAACM,MAAM,CAACC,OAAO,CAAC,CACzE;MACDV,WAAW,CAACW,UAAU,CAACV,uBAAuB,CAACG,YAAY,EAAEL,KAAK,CAAC,CAAC;;;EAIxE,IAAIa,QAAQ,EAAE;QACZC,GAA6B;IAA7Bb,WAAW,QAAkB,GAA7B,MAA6B,GAA7B,CAAAa,GAA6B,GAA7Bb,WAAW,CAAEG,gBAAgB,YAA7B,MAA6B,GAA7BU,GAA6B,CAAEC,GAAG,CAACf,KAAK,CAACgB,QAAQ,CAAC;IAClDb,UAAU,EAAE;;EAGdc,yBAAyB,CAAC,MAAM;QAC9BC,IAA6B;IAA7BjB,WAAW,QAAkB,GAA7B,MAA6B,GAA7B,CAAAiB,IAA6B,GAA7BjB,WAAW,CAAEG,gBAAgB,YAA7B,MAA6B,GAA7Bc,IAA6B,CAAEH,GAAG,CAACf,KAAK,CAACgB,QAAQ,CAAC;IAClD,OAAO,MAAM;UACXF,GAA6B;MAA7Bb,WAAW,QAAkB,GAA7B,MAA6B,GAA7B,CAAAa,GAA6B,GAA7Bb,WAAW,CAAEG,gBAAgB,YAA7B,MAA6B,GAA7BU,GAA6B,CAAEK,MAAM,CAACnB,KAAK,CAACgB,QAAQ,CAAC;KACtD;GACF,CAAC;EAEF;EACA;EACA;EACA;EACA;EACAC,yBAAyB,CAAC,MAAM;IAC9B,IAAIhB,WAAW,EAAE;MACfA,WAAW,CAACmB,cAAc,GAAGjB,UAAU;;IAEzC,OAAO,MAAM;MACX,IAAIF,WAAW,EAAE;QACfA,WAAW,CAACmB,cAAc,GAAGjB,UAAU;;KAE1C;GACF,CAAC;EAEFkB,mBAAmB,CAAC,MAAM;IACxB,IAAIpB,WAAW,IAAIA,WAAW,CAACmB,cAAc,EAAE;MAC7CnB,WAAW,CAACmB,cAAc,EAAE;MAC5BnB,WAAW,CAACmB,cAAc,GAAG,IAAI;;IAEnC,OAAO,MAAM;MACX,IAAInB,WAAW,IAAIA,WAAW,CAACmB,cAAc,EAAE;QAC7CnB,WAAW,CAACmB,cAAc,EAAE;QAC5BnB,WAAW,CAACmB,cAAc,GAAG,IAAI;;KAEpC;GACF,CAAC;EAEF,OAAO,IAAI;;AAzDb,MAAMP,QAAQ,GAAG,OAAOS,MAAM,KAAK,WAAW;AAC9C,MAAML,yBAAyB,GAAGJ,QAAQ,GAAG,MAAM,EAAE,GAAGhB,MAAe,CAAA0B,eAAA;AACvE,MAAMF,mBAAmB,GAAGR,QAAQ,GAAG,MAAM,EAAE,GAAGhB,MAAS,CAAA2B,SAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}